from django.shortcuts import render, redirect
from .forms import MyDateForm
import datetime, calendar
from django.http import HttpResponse
from .models import MyDate
from django.views.generic import TemplateView

year726 = {1900:259,
1901:104,
1902:209,
1903:54,
1904:159,
1905:4,
1906:109,
1907:214,
1908:59,
1909:164,
1910:9,
1911:114,
1912:219,
1913:64,
1914:169,
1915:14,
1916:119,
1917:224,
1918:69,
1919:174,
1920:19,
1921:124,
1922:229,
1923:74,
1924:179,
1925:24,
1926:129,
1927:234,
1928:79,
1929:184,
1930:29,
1931:134,
1932:239,
1933:84,
1934:189,
1935:34,
1936:139,
1937:244,
1938:89,
1939:194,
1940:39,
1941:144,
1942:249,
1943:94,
1944:199,
1945:44,
1946:149,
1947:254,
1948:99,
1949:204,
1950:49,
1951:154,
1952:259,
1953:104,
1954:209,
1955:54,
1956:159,
1957:4,
1958:109,
1959:214,
1960:59,
1961:164,
1962:9,
1963:114,
1964:219,
1965:64,
1966:169,
1967:14,
1968:119,
1969:224,
1970:69,
1971:174,
1972:19,
1973:124,
1974:229,
1975:74,
1976:179,
1977:24,
1978:129,
1979:234,
1980:79,
1981:184,
1982:29,
1983:134,
1984:239,
1985:84,
1986:189,
1987:34,
1988:139,
1989:244,
1990:89,
1991:194,
1992:39,
1993:144,
1994:249,
1995:94,
1996:199,
1997:44,
1998:149,
1999:254,
2000:99,
2001:204,
2002:49,
2003:154,
2004:259,
2005:104,
2006:209,
2007:54,
2008:159,
2009:4,
2010:109,
2011:214,
2012:59,
2013:164,
2014:9,
2015:114,
2016:219,
2017:64,
2018:169,
2019:14,
2020:119,
2021:224,
2022:69,
2023:174,
2024:19,
2025:124,
2026:229,
2027:74,
2028:179,
2029:24,
2030:129,
2031:234,
2032:79,
2033:184,
2034:29,
2035:134,
2036:239,
2037:84,
2038:189,
2039:34,
2040:139,
2041:244,
2042:89,
2043:194,
2044:39,
2045:144,
2046:249,
2047:94,
2048:199,
2049:44,
2050:149,
2051:254,
2052:99,
2053:204,
2054:49,
2055:154,
2056:259,
2057:104,
2058:209,
2059:54,
2060:159,
2061:4,
2062:109,
2063:214,
2064:59,
2065:164,
2066:9,
2067:114,
2068:219,
2069:64,
2070:169,
2071:14,
2072:119,
2073:224,
2074:69,
2075:174,
2076:19,
2077:124,
2078:229,
2079:74,
2080:179,
2081:24,
2082:129,
2083:234,
2084:79,
2085:184,
2086:29,
2087:134,
2088:239,
2089:84,
2090:189,
2091:34,
2092:139,
2093:244,
2094:89,
2095:194,
2096:39,
2101:44,
2097:144,
2098:249,
2099:94,
2100:199,
2102:149,
2103:254,
2104:99,
2105:204,
2106:49,
2107:154,
}

kin_name ={
1:'赤い磁気の竜',
2:'白い月の風',
3:'青い電気の夜',
4:'黄色い自己存在の種',
5:'赤い倍音の蛇',
6:'白い律動の世界の橋渡し',
7:'青い共振の手',
8:'黄色い銀河の星',
9:'赤い太陽の月',
10:'白い惑星の犬',
11:'青いスペクトルの猿',
12:'黄色い水晶の人',
13:'赤い宇宙の空歩く者',
14:'白い磁気の魔法使い',
15:'青い月の鷲',
16:'黄色い電気の戦士',
17:'赤い自己存在の地球',
18:'白い倍音の鏡',
19:'青い律動の嵐',
20:'黄色い共振の太陽',
21:'赤い銀河の竜',
22:'白い太陽の風',
23:'青い惑星の夜',
24:'黄色いスペクトルの種',
25:'赤い水晶の蛇',
26:'白い宇宙の世界の橋渡し',
27:'青い磁気の手',
28:'黄色い月の星',
29:'赤い電気の月',
30:'白い自己存在の犬',
31:'青い倍音の猿',
32:'黄色い律動の人',
33:'赤い共振の空歩く者',
34:'白い銀河の魔法使い',
35:'青い太陽の鷲',
36:'黄色い惑星の戦士',
37:'赤いスペクトルの地球',
38:'白い水晶の鏡',
39:'青い宇宙の嵐',
40:'黄色い磁気の太陽',
41:'赤い月の竜',
42:'白い電気の風',
43:'青い自己存在の夜',
44:'黄色い倍音の種',
45:'赤い律動の蛇',
46:'白い共振の世界の橋渡し',
47:'青い銀河の手',
48:'黄色い太陽の星',
49:'赤い惑星の月',
50:'白いスペクトルの犬',
51:'青い水晶の猿',
52:'黄色い宇宙の人',
53:'赤い磁気の空歩く者',
54:'白い月の魔法使い',
55:'青い電気の鷲',
56:'黄色い自己存在の戦士',
57:'赤い倍音の地球',
58:'白い律動の鏡',
59:'青い共振の嵐',
60:'黄色い銀河の太陽',
61:'赤い太陽の竜',
62:'白い惑星の風',
63:'青いスペクトルの夜',
64:'黄色い水晶の種',
65:'赤い宇宙の蛇',
66:'白い磁気の世界の橋渡し',
67:'青い月の手',
68:'黄色い電気の星',
69:'赤い自己存在の月',
70:'白い倍音の犬',
71:'青い律動の猿',
72:'黄色い共振の人',
73:'赤い銀河の空歩く者',
74:'白い太陽の魔法使い',
75:'青い惑星の鷲',
76:'黄色いスペクトルの戦士',
77:'赤い水晶の地球',
78:'白い宇宙の鏡',
79:'青い磁気の嵐',
80:'黄色い月の太陽',
81:'赤い電気の竜',
82:'白い自己存在の風',
83:'青い倍音の夜',
84:'黄色い律動の種',
85:'赤い共振の蛇',
86:'白い銀河の世界の橋渡し',
87:'青い太陽の手',
88:'黄色い惑星の星',
89:'赤いスペクトルの月',
90:'白い水晶の犬',
91:'青い宇宙の猿',
92:'黄色い磁気の人',
93:'赤い月の空歩く者',
94:'白い電気の魔法使い',
95:'青い自己存在の鷲',
96:'黄色い倍音の戦士',
97:'赤い律動の地球',
98:'白い共振の鏡',
99:'青い銀河の嵐',
100:'黄色い太陽の太陽',
101:'赤い惑星の竜',
102:'白いスペクトルの風',
103:'青い水晶の夜',
104:'黄色い宇宙の種',
105:'赤い磁気の蛇',
106:'白い月の世界の橋渡し',
107:'青い電気の手',
108:'黄色い自己存在の星',
109:'赤い倍音の月',
110:'白い律動の犬',
111:'青い共振の猿',
112:'黄色い銀河の人',
113:'赤い太陽の空歩く者',
114:'白い惑星の魔法使い',
115:'青いスペクトルの鷲',
116:'黄色い水晶の戦士',
117:'赤い宇宙の地球',
118:'白い磁気の鏡',
119:'青い月の嵐',
120:'黄色い電気の太陽',
121:'赤い自己存在の竜',
122:'白い倍音の風',
123:'青い律動の夜',
124:'黄色い共振の種',
125:'赤い銀河の蛇',
126:'白い太陽の世界の橋渡し',
127:'青い惑星の手',
128:'黄色いスペクトルの星',
129:'赤い水晶の月',
130:'白い宇宙の犬',
131:'青い磁気の猿',
132:'黄色い月の人',
133:'赤い電気の空歩く者',
134:'白い自己存在の魔法使い',
135:'青い倍音の鷲',
136:'黄色い律動の戦士',
137:'赤い共振の地球',
138:'白い銀河の鏡',
139:'青い太陽の嵐',
140:'黄色い惑星の太陽',
141:'赤いスペクトルの竜',
142:'白い水晶の風',
143:'青い宇宙の夜',
144:'黄色い磁気の種',
145:'赤い月の蛇',
146:'白い電気の世界の橋渡し',
147:'青い自己存在の手',
148:'黄色い倍音の星',
149:'赤い律動の月',
150:'白い共振の犬',
151:'青い銀河の猿',
152:'黄色い太陽の人',
153:'赤い惑星の空歩く者',
154:'白いスペクトルの魔法使い',
155:'青い水晶の鷲',
156:'黄色い宇宙の戦士',
157:'赤い磁気の地球',
158:'白い月の鏡',
159:'青い電気の嵐',
160:'黄色い自己存在の太陽',
161:'赤い倍音の竜',
162:'白い律動の風',
163:'青い共振の夜',
164:'黄色い銀河の種',
165:'赤い太陽の蛇',
166:'白い惑星の世界の橋渡し',
167:'青いスペクトルの手',
168:'黄色い水晶の星',
169:'赤い宇宙の月',
170:'白い磁気の犬',
171:'青い月の猿',
172:'黄色い電気の人',
173:'赤い自己存在の空歩く者',
174:'白い倍音の魔法使い',
175:'青い律動の鷲',
176:'黄色い共振の戦士',
177:'赤い銀河の地球',
178:'白い太陽の鏡',
179:'青い惑星の嵐',
180:'黄色いスペクトルの太陽',
181:'赤い水晶の竜',
182:'白い宇宙の風',
183:'青い磁気の夜',
184:'黄色い月の種',
185:'赤い電気の蛇',
186:'白い自己存在の世界の橋渡し',
187:'青い倍音の手',
188:'黄色い律動の星',
189:'赤い共振の月',
190:'白い銀河の犬',
191:'青い太陽の猿',
192:'黄色い惑星の人',
193:'赤いスペクトルの空歩く者',
194:'白い水晶の魔法使い',
195:'青い宇宙の鷲',
196:'黄色い磁気の戦士',
197:'赤い月の地球',
198:'白い電気の鏡',
199:'青い自己存在の嵐',
200:'黄色い倍音の太陽',
201:'赤い律動の竜',
202:'白い共振の風',
203:'青い銀河の夜',
204:'黄色い太陽の種',
205:'赤い惑星の蛇',
206:'白いスペクトルの世界の橋渡し',
207:'青い水晶の手',
208:'黄色い宇宙の星',
209:'赤い磁気の月',
210:'白い月の犬',
211:'青い電気の猿',
212:'黄色い自己存在の人',
213:'赤い倍音の空歩く者',
214:'白い律動の魔法使い',
215:'青い共振の鷲',
216:'黄色い銀河の戦士',
217:'赤い太陽の地球',
218:'白い惑星の鏡',
219:'青いスペクトルの嵐',
220:'黄色い水晶の太陽',
221:'赤い宇宙の竜',
222:'白い磁気の風',
223:'青い月の夜',
224:'黄色い電気の種',
225:'赤い自己存在の蛇',
226:'白い倍音の世界の橋渡し',
227:'青い律動の手',
228:'黄色い共振の星',
229:'赤い銀河の月',
230:'白い太陽の犬',
231:'青い惑星の猿',
232:'黄色いスペクトルの人',
233:'赤い水晶の空歩く者',
234:'白い宇宙の魔法使い',
235:'青い磁気の鷲',
236:'黄色い月の戦士',
237:'赤い電気の地球',
238:'白い自己存在の鏡',
239:'青い倍音の嵐',
240:'黄色い律動の太陽',
241:'赤い共振の竜',
242:'白い銀河の風',
243:'青い太陽の夜',
244:'黄色い惑星の種',
245:'赤いスペクトルの蛇',
246:'白い水晶の世界の橋渡し',
247:'青い宇宙の手',
248:'黄色い磁気の星',
249:'赤い月の月',
250:'白い電気の犬',
251:'青い自己存在の猿',
252:'黄色い倍音の人',
253:'赤い律動の空歩く者',
254:'白い共振の魔法使い',
255:'青い銀河の鷲',
256:'黄色い太陽の戦士',
257:'赤い惑星の地球',
258:'白いスペクトルの鏡',
259:'青い水晶の嵐',
260:'黄色い宇宙の太陽',
}

def check_leap_year(year):
    if calendar.isleap(year):
        return year

def datenew(request):
    if request.method == "POST":
        form = MyDateForm(request.POST)
        if form.is_valid():
            mydate = form.save(commit=False)
            if mydate.month == 2 and mydate.day == 29:
                kin = "フナブ・クの日"
            elif mydate.month >=7 and mydate.day >25:
                input_day=datetime.date(mydate.year,mydate.month,mydate.day)
                base_day=datetime.date(mydate.year,7,26)
                elapsed_days=(input_day-base_day).days
                kin=year726[mydate.year]+elapsed_days
                while kin>260:
                    kin -=260
                sign = kin_name[kin]
            elif check_leap_year(mydate.year) == mydate.year and mydate.month >=3:
                input_day=datetime.date(mydate.year,mydate.month,mydate.day)
                mydate.year -=1
                base_day=datetime.date(mydate.year,7,27)
                elapsed_days=(input_day-base_day).days
                kin=year726[mydate.year]+elapsed_days
                while kin>260:
                    kin -=260
                sign = kin_name[kin]
            else:
                input_day=datetime.date(mydate.year,mydate.month,mydate.day)
                mydate.year -=1
                base_day=datetime.date(mydate.year,7,26)
                elapsed_days=(input_day-base_day).days
                kin=year726[mydate.year]+elapsed_days
                while kin>260:
                    kin -=260
                sign = kin_name[kin]
            mydate.save()
        return render(request, 'blogapp/result.html', {'kin':kin, 'sign':sign})
    else:
        kin='誕生日を入力してください'
        form = MyDateForm()
    return render(request, 'blogapp/index.html', {'form': form, 'kin': kin})

class Result(TemplateView):
    template_name = 'blogapp/result.html'
    model = MyDate
